# Campaign Canvas - Project Context for Claude

## Project Overview

**Campaign Canvas** is an AI-powered social media campaign generator for small businesses. It creates ultra-specific, niche and location-aware campaigns by deeply understanding brand voice, target personas, and business context.

**Tech Stack**:
- **Frontend**: Vite + React + TypeScript + Shadcn/UI
- **Backend**: Supabase (PostgreSQL + Edge Functions)
- **AI**: Lovable AI Gateway (Google Gemini 2.5 Flash)
- **Deployment**: Lovable Cloud

---

## Core Philosophy: KISS + Specificity

### Design Principles

1. **Ultra-Specific Campaigns**: Location + Persona + Problem = Precise Messaging
   - ❌ "Social media for ice cream shops"
   - ✅ "Instagram campaign for Date Night Dani in Springfield, IL"

2. **Multi-Persona Strategy**:
   - Businesses have 3-5 personas (ice cream shop: Date Night Dani, Event Planner Emma, Treat Time Tom)
   - Each campaign targets ONE primary persona
   - Optional secondary persona for broader reach

3. **Minimal Friction**:
   - MVP focuses on essential fields only
   - Smart defaults and example-driven UX
   - Progressive disclosure for advanced features

---

## Project Structure

```
campaign-canvas-39/
├── src/
│   ├── components/
│   │   ├── ui/                          # Shadcn UI components
│   │   ├── PersonaModalSimplified.tsx   # 228 lines (was 540)
│   │   ├── FileUploadModal.tsx          # AI-powered file upload
│   │   └── ReviewSuggestionsModal.tsx   # Review AI suggestions
│   │
│   ├── pages/
│   │   ├── Landing.tsx                  # User selection (3 demo users)
│   │   ├── Dashboard.tsx                # Main dashboard
│   │   ├── BrandHubSimplified.tsx       # 467 lines (was 838) ✅ ACTIVE
│   │   ├── Onboarding.tsx               # New user flow
│   │   ├── Campaign.tsx                 # Full campaign view
│   │   ├── CampaignWorking.tsx          # Active campaign generator
│   │   ├── CampaignResults.tsx          # Generated campaign display
│   │   └── Settings.tsx                 # User settings
│   │
│   ├── data/
│   │   ├── profiles.ts                  # BusinessProfile & Persona interfaces
│   │   └── mockCampaigns.ts             # Mock campaign data
│   │
│   ├── config/
│   │   └── campaignPrompts.ts           # ✅ NEW: Agent prompts (312 lines)
│   │
│   ├── utils/
│   │   └── storage.ts                   # Supabase + localStorage helpers
│   │
│   ├── integrations/
│   │   └── supabase/                    # Auto-generated by Lovable
│   │       ├── client.ts                # Supabase client
│   │       └── types.ts                 # Database types
│   │
│   └── App.tsx                          # Main routes
│
├── supabase/
│   ├── migrations/                      # Database migrations
│   └── functions/
│       ├── process-brand-upload/        # Edge function for AI file processing
│       │   └── index.ts
│       └── generate-campaign/           # ✅ NEW: Multi-agent campaign generator
│           └── index.ts                 # 467 lines, 3-stage system
│
├── SETUP_GUIDE.md                       # Setup instructions
├── BRAND_HUB_IMPLEMENTATION.md          # Feature docs
└── PROJECT_OVERVIEW.md                  # High-level overview
```

---

## Data Schema (Simplified MVP)

### Persona (6 fields - down from 15)

```typescript
interface Persona {
  id: string;
  name: string;              // "Date Night Dani", "Fix-It Felix"
  emoji: string;             // 💑, 🔧
  who_are_they: string;      // "Young couples (25-35) seeking Instagram-worthy dates"
  main_problem: string;      // "Want unique spots worth posting about"
  platforms: string[];       // ["instagram", "tiktok"] (max 3)
  real_example?: string;     // Optional customer story
}
```

**Removed**: demographics object, psychographics arrays, social_behavior details
**Why**: AI infers age/income from description; ONE problem > 5 pain points

### BusinessProfile (8 fields - down from 30+)

```typescript
interface BusinessProfile {
  id: string;
  business_name: string;           // "Stack Creamery"
  niche: string;                   // "ice_cream_shop"
  locations: string[];             // ["Springfield, IL"]
  what_we_offer: string;           // Multi-sentence description
  voice: {
    tone: string;                  // Single-select: "fun_playful"
    signature_phrases: string[];   // ["stack it up", "drip"] (max 5)
  };
  personas: Persona[];             // Multiple personas (3-5 typical)
}
```

**Removed**: programs, brand_identity, content_rules, audience, owner_name
**Why**: Not used in AI content generation; added complexity without value

---

## Key Features

### 1. Brand Hub (Simplified)

**Location**: `src/pages/BrandHubSimplified.tsx`

**3 Sections**:
1. **Business Basics** - Name, locations, what you offer
2. **Voice & Tone** - Single-select tone + 5 signature phrases
3. **Target Personas** - Multi-persona support, simplified modal

**Auto-save**: Every 30 seconds if changes detected

**UX Improvements**:
- Example-driven prompts ("e.g., Young couples seeking...")
- Helper text on every field
- Smart defaults
- Max limits (3 platforms, 5 phrases)

### 2. Persona Builder

**Location**: `src/components/PersonaModalSimplified.tsx`

**Form Fields** (2-3 min to complete):
1. Emoji picker (12 options)
2. Persona name (with helper: "alliterative name")
3. Who are they? (1-2 sentences)
4. Main problem/goal (single textarea)
5. Platforms (checkboxes, max 3)
6. Real example (optional)

**Examples in Preloaded Profiles**:
- **Stack Creamery**: Date Night Dani 💑, Event Planner Emma 🎉, Treat Time Tom 👨‍👧
- **Quick Fix Plumbing**: Fix-It Felix 🔧, Clueless Carla 🤷‍♀️, Property Manager Pete 🏢

### 3. Campaign Generation (Multi-Agent System) ✅ IMPLEMENTED

**Status**: Fully implemented as of Oct 9, 2025

**Core Differentiator**: High-quality, human-sounding content that avoids AI slop through strategic depth and natural cadence.

**Architecture**: Three-stage agent system (Strategy → Calendar → Copywriter)

See detailed documentation in **"Campaign Generation Agent System"** section below.

---

## Lovable AI Integration

### How It Works

Edge functions run locally (Supabase CLI) or in production (Supabase Edge Runtime), calling Lovable AI Gateway over HTTPS.

**Edge Function**: `supabase/functions/process-brand-upload/index.ts`

```typescript
const lovableApiKey = Deno.env.get("LOVABLE_API_KEY");

const response = await fetch("https://ai.gateway.lovable.dev/v1/chat/completions", {
  method: "POST",
  headers: {
    "Authorization": `Bearer ${lovableApiKey}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    model: "google/gemini-2.5-flash",
    messages: [/* your messages */]
  })
});
```

**Local Development**:
- Edge functions run via `supabase start`
- Calls Lovable AI Gateway (requires internet)
- Same behavior as production

**Free Tier**: Until Oct 13, 2025, all Gemini calls are FREE

---

## Campaign Generation Agent System

**Status**: ✅ Fully Implemented (Oct 9, 2025)
**Location**: `src/config/campaignPrompts.ts` + `supabase/functions/generate-campaign/index.ts`

### Philosophy: Avoiding AI Slop

**Problem**: Most AI-generated marketing content is generic, buzzword-filled, and obviously not human-written. This creates user distrust and poor engagement.

**Solution**: Multi-agent system that separates strategic thinking from tactical execution, with built-in "natural cadence" rules.

**Key Differentiator**: Content that sounds like a person talking, not a polished marketing message.

---

### Architecture: Three-Stage Agent System

```
┌─────────────────────────────────────────────────────────────┐
│  STAGE 1: PERSONA STRATEGY AGENT                            │
│  Input: Business goal in natural language                   │
│  Output: Recommended personas + emotional strategy          │
│  User Action: Review/edit/approve                           │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STAGE 2: CONTENT CALENDAR AGENT                            │
│  Input: Approved persona strategies                         │
│  Output: Day-by-day strategic content plan                  │
│  User Action: Review calendar                               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  STAGE 3: COPYWRITER AGENT (Simple MVP)                     │
│  Input: Individual post strategy                            │
│  Output: Natural-sounding copy + hashtags                   │
│  User Action: Edit/approve copy                             │
└─────────────────────────────────────────────────────────────┘
```

---

### Stage 1: Persona Strategy Agent

**Mental Model Shift**: Business owners think in business goals ("promote new flavor"), NOT personas. Agent does the strategic translation.

**User Input**:
```javascript
{
  "campaign_goal": "Promote new strawberry cheesecake flavor, get people in this weekend",
  "duration_days": 7
}
```

**Agent Analysis**:
1. Reviews ALL personas in BusinessProfile
2. Determines which personas care about THIS specific goal
3. Explains WHY each persona is relevant (not generic)
4. Defines emotional strategy per persona
5. Assigns high-intent actions (saves > likes)

**Agent Output**:
```javascript
{
  "campaign_goal": "Promote new strawberry cheesecake flavor, drive weekend traffic",
  "persona_strategies": [
    {
      "persona_name": "Date Night Dani",
      "persona_emoji": "💑",
      "why_target_them": "New flavors create Instagram-worthy moments. Dani seeks unique date experiences worth posting about. Strawberry cheesecake is visually striking + trendy.",
      "key_message": "Springfield's newest must-photograph date night moment",
      "desired_emotion": "FOMO + curiosity",
      "emotional_driver": "Fear of missing the next trending spot. Curiosity about what makes it photo-worthy.",
      "immediate_action": "save_post",
      "action_intent_level": "high",
      "platforms": ["instagram", "tiktok"],
      "expected_outcome": "20-30 couples, weekend evening traffic 6-10pm"
    },
    {
      "persona_name": "Treat Time Tom",
      "persona_emoji": "👨‍👧",
      "why_target_them": "Parents looking for special treats to surprise kids. New flavor = excitement factor. Strawberry cheesecake appeals to kids' taste.",
      "key_message": "Surprise the kids with something they haven't tried yet",
      "desired_emotion": "excitement + anticipation",
      "emotional_driver": "Want to be the hero parent who brings something new and exciting. Anticipation of kids' happy reactions.",
      "immediate_action": "share_with_coparent",
      "action_intent_level": "high",
      "platforms": ["facebook", "google_business"],
      "expected_outcome": "25-35 families, weekend afternoon traffic 2-6pm"
    }
  ],
  "strategy_summary": "Double-pronged approach: Create visual buzz with couples (evening traffic) while targeting parents for family visits (afternoon traffic). Both personas respond to 'newness' but need different emotional hooks."
}
```

**Approval Gate**: User reviews, can edit messages/emotions/personas before proceeding to Stage 2.

---

### Stage 2: Content Calendar Agent

**Input**: Approved persona strategies from Stage 1

**Agent Responsibilities**:
1. Orchestrate customer journey: Awareness → Consideration → Conversion
2. Distribute posts across personas and platforms
3. Match timing to persona behavior (parents: afternoon, couples: evening)
4. Assign emotions and actions from Stage 1
5. Create strategic direction (WHAT/WHY, not HOW)

**Agent Output**:
```javascript
{
  "content_calendar": {
    "overview": {
      "total_posts": 12,
      "platform_breakdown": {"instagram": 5, "tiktok": 3, "facebook": 4},
      "flow": "Days 1-3: Awareness (curiosity building) → Days 4-5: Consideration (social proof) → Days 6-7: Conversion (urgency)"
    },
    "posts": [
      {
        "day": 1,
        "post_id": "P1",
        "time_of_day": "7:00 PM",

        "target_persona": "Date Night Dani",
        "platform": "instagram",
        "format": "reel",

        "desired_emotion": "curiosity",
        "emotional_hook": "Make them wonder what's special about this flavor that everyone's talking about",

        "immediate_action": "save_post",
        "action_intent_level": "high",
        "engagement_goal": "100+ saves",
        "why_this_action": "Saves indicate planning intent - they're bookmarking to show partner or visit later. Higher conversion signal than likes.",

        "journey_stage": "awareness",
        "content_direction": "Tease the visual reveal of the strawberry cheesecake stack without showing full product. Focus on anticipation and aesthetic appeal.",
        "key_message": "Springfield's newest must-see dessert",

        "cta_goal": "save_post_or_tag_friend",
        "cta_rationale": "Tagging = social planning behavior. Saving = personal intent. Both are high-value actions.",

        "primary_metric": "saves",
        "secondary_metrics": ["shares", "profile_visits"],
        "vanity_metrics_ignore": ["likes", "general_comments"]
      }
      // ... more posts
    ]
  }
}
```

**Key Concepts**:
- **Journey Stages**:
  - Awareness (Days 1-40%): Create curiosity/FOMO
  - Consideration (Days 40-70%): Build trust, social proof
  - Conversion (Days 70-100%): Create urgency, drive action
- **Engagement Intent Hierarchy**:
  - HIGH: saves, shares_to_specific_person, link_clicks, dm_questions
  - MEDIUM: shares_general, story_replies, comments_social
  - LOW: likes_only, views_without_action (vanity metrics)
- **Content Direction**: Strategic intent (what to show and why), NOT creative execution (how to shoot/edit)

---

### Stage 3: Copywriter Agent (Simple MVP)

**Input**: Individual post strategy from Stage 2 + BusinessProfile + Persona

**Goal**: Write copy that sounds like a PERSON talking, not a polished marketing message.

**Natural Cadence Rules**:
```
✅ DO:
- Write like texting a friend
- Use conversational fillers ("like", "literally", "okay but", "wait", "anyway")
- Lowercase is fine if it fits the vibe
- Incomplete sentences are GOOD
- Vary sentence length (short. long rambling sentence. short.)
- Use signature phrases naturally
- Can break grammar rules for authentic voice

❌ NEVER:
- "Elevate", "Unlock", "Imagine this", "Picture this", "Ready to [verb]"
- Buzzword soup: "next level", "game-changer", "transform your"
- Overly enthusiastic emojis (1-3 max, placed naturally)
- Formulaic structures (not everything needs to be "3 tips")
```

**Example Output**:
```javascript
{
  "hook": "wait omg have you been to Stack Creamery yet",
  "script": "because if date night has been feeling kinda basic lately... this is your sign\n\nthe new strawberry cheesecake flavor is insane (loaded with toppings, towering situation)\n\nperfect for those 'we need a pic for the gram' moments\n\nSpringfield friends where have you been hiding this 👀\n\nopen late this weekend, link in bio if you wanna see the full menu",
  "hashtags": ["#SpringfieldIL", "#DateNightIdeas", "#StackCreamery"],
  "visual_direction": "POV: couple's hands holding phones up to capture the stack, faces in background smiling/laughing"
}
```

**Compare to AI Slop**:
```
❌ Generic AI Output:
"Elevate your date night experience with our artisanal strawberry cheesecake creation!
Perfect for couples seeking Instagram-worthy moments. Visit us today! 🍦✨"

✅ Natural Human Output:
"wait omg have you been to Stack Creamery yet...
because if date night has been feeling kinda basic lately, this is your sign"
```

**Difference**:
- Conversational fillers ("wait omg", "kinda")
- Incomplete thoughts ("...")
- No marketing buzzwords ("elevate", "artisanal")
- Has personality/opinion
- Sounds like texting a friend

---

### Implementation Details

**Files**:
1. **`src/config/campaignPrompts.ts`** (312 lines)
   - System prompts for all 3 agents
   - User prompt builders with dynamic data injection
   - Helper functions (calculatePostCount)

2. **`supabase/functions/generate-campaign/index.ts`** (467 lines)
   - Main handler routes to 3 stages
   - `handlePersonaStrategy()` - Stage 1
   - `handleContentCalendar()` - Stage 2
   - `handleCopywriter()` - Stage 3
   - Shared `callAI()` utility for Gemini calls

**API Usage**:

```javascript
// Stage 1: Generate persona strategies
POST /functions/v1/generate-campaign
{
  "stage": "persona_strategy",
  "profile": { /* BusinessProfile */ },
  "brief": {
    "campaign_goal": "Promote new flavor, get weekend traffic",
    "duration_days": 7
  }
}

// Stage 2: Generate content calendar
POST /functions/v1/generate-campaign
{
  "stage": "content_calendar",
  "profile": { /* BusinessProfile */ },
  "brief": { /* CampaignBrief */ },
  "approvedStrategies": { /* Result from Stage 1 */ }
}

// Stage 3: Generate copy for a post
POST /functions/v1/generate-campaign
{
  "stage": "copywriter",
  "profile": { /* BusinessProfile */ },
  "persona": { /* Specific Persona */ },
  "postStrategy": { /* Single post from Stage 2 */ }
}
```

---

### Design Decisions & Rationale

**Why Three Stages Instead of One?**
- **Separation of Concerns**: Strategy ≠ Execution
- **User Control**: Approval gates at strategic decision points
- **Quality**: Each agent specializes in one thing
- **Debugging**: Easier to identify where things go wrong

**Why Agent Analyzes All Personas (Not User-Selected)?**
- **Mental Model**: Owners think "promote new product", not "target Date Night Dani"
- **Discovery**: Agent may identify personas owner didn't consider
- **Education**: Explains WHY certain audiences matter
- **Efficiency**: One goal can hit multiple personas with different angles

**Why Emotion-Driven vs. Feature-Driven?**
- **Psychology**: People buy based on emotion, justify with logic
- **Engagement**: Curiosity/FOMO drives saves/shares better than product features
- **Natural Copy**: "Make them excited" is easier instruction than "list 3 benefits"

**Why Engagement Intent Hierarchy?**
- **Conversion Focus**: Saves/shares indicate planning behavior (high intent)
- **Vanity Metrics**: Likes feel good but don't drive business outcomes
- **Strategic Metrics**: Agent optimizes for actions that lead to conversions

**Why Real Examples Optional?**
- **User Friction**: Not all owners have documented customer stories
- **Inference**: Agent can create believable scenarios from persona description
- **Authenticity**: When available, real examples make content feel genuine

**Why Natural Cadence Rules?**
- **Trust Signal**: "Sounds like person talking" = higher engagement
- **Differentiation**: Most AI content is obviously robotic
- **Platform Fit**: Social media rewards conversational tone over formal marketing

---

### Anti-Slop Mechanisms

**1. Banned Phrase List**
- "Elevate", "Unlock", "Imagine this", "Picture this", "Ready to [verb]"
- "Next level", "Game-changer", "Transform your"
- Forces agent to find natural alternatives

**2. Specificity Requirements**
- Must reference location (Springfield, IL not "your area")
- Must reference persona's specific problem
- Must use signature phrases naturally
- Generic = rejected

**3. Engagement Intent Focus**
- Can't just say "increase engagement"
- Must specify: "100+ saves (planning behavior)"
- Explains WHY this metric matters for conversion

**4. Journey Architecture**
- Posts must progress: Awareness → Consideration → Conversion
- Can't be random disconnected content
- Each post advances customer toward action

**5. Emotional Strategy**
- Can't be vague "make them interested"
- Must specify: "curiosity about what makes it photo-worthy"
- Explains psychological driver behind emotion

---

### What Makes This System Special

**1. Strategic Depth Over Tactical Spam**
- Thinks in customer journeys, not random posts
- Orchestrates multi-persona campaigns coherently
- Explains reasoning at every step

**2. Business Owner Mental Model**
- Owner thinks in business goals, agent translates to personas
- No cognitive burden to "think in frameworks"
- Educational - shows WHY certain approaches work

**3. High-Intent Action Focus**
- Optimizes for conversions, not vanity metrics
- Understands saves/shares > likes
- Explains relationship between action and business outcome

**4. Natural Human Voice**
- Avoids AI slop through cadence rules
- Sounds like texting a friend, not writing ad copy
- Can break grammar rules for authenticity

**5. Approval Gates**
- User reviews strategy before content generation
- Can edit personas/emotions/messages
- Maintains control while leveraging AI intelligence

**6. Real Example Integration**
- Uses customer stories when available
- Infers believable scenarios when not
- Never sounds generic

---

### Future Enhancements (Not Yet Implemented)

**Content Creation**:
- [ ] Deep copywriter session to refine natural cadence
- [ ] Platform-specific voice variations (Instagram vs LinkedIn)
- [ ] A/B testing different copy approaches
- [ ] Slop detection scoring system

**Strategy Improvements**:
- [ ] Multi-campaign orchestration (how campaigns relate over time)
- [ ] Seasonal strategy recommendations
- [ ] Competitive analysis integration
- [ ] Performance feedback loop (what worked/didn't)

**User Experience**:
- [ ] Frontend UI for Stage 1 (persona strategy approval)
- [ ] Frontend UI for Stage 2 (content calendar view)
- [ ] Frontend UI for Stage 3 (copy editing interface)
- [ ] Visual campaign timeline
- [ ] Export to scheduling tools (Buffer, Hootsuite)

**Analytics**:
- [ ] Track actual engagement vs. predicted
- [ ] Measure high-intent actions (saves, shares)
- [ ] Campaign performance dashboard
- [ ] ROI attribution

---

### Testing & Quality Assurance

**Manual Testing Checklist**:

**Stage 1: Persona Strategy**
- [ ] Agent recommends only relevant personas
- [ ] Emotional strategies match persona psychology
- [ ] Expected outcomes are concrete (not vague)
- [ ] Action intent levels align with journey stage
- [ ] Strategy summary explains reasoning

**Stage 2: Content Calendar**
- [ ] Posts progress through journey stages (A→C→C)
- [ ] Timing matches persona behavior
- [ ] Emotions/actions match Stage 1 approval
- [ ] No repetitive formats or messages
- [ ] Platform distribution matches persona preferences

**Stage 3: Copywriter**
- [ ] Copy sounds natural, not robotic
- [ ] No banned phrases used
- [ ] Signature phrases used naturally (not forced)
- [ ] Location referenced specifically
- [ ] Persona's problem addressed
- [ ] CTA drives intended action

**Integration Testing**:
- [ ] Stage 1 output feeds cleanly into Stage 2
- [ ] Stage 2 output feeds cleanly into Stage 3
- [ ] All three stages use same BusinessProfile data
- [ ] Approved strategies persist correctly

---

### Troubleshooting

**Agent Returns Generic Strategies**:
- Check if persona descriptions are specific enough
- Verify `real_example` is being included in prompt
- Review persona's `main_problem` - is it concrete?
- Check if `signature_phrases` are distinctive

**Copy Sounds Too Formal/Robotic**:
- Verify brand `voice.tone` is set correctly
- Check if banned phrases are in output (shouldn't be)
- Review prompt - ensure "natural cadence rules" are included
- Test with different tone settings

**Persona Recommendations Don't Make Sense**:
- Verify campaign goal is clear and specific
- Check persona `who_are_they` descriptions
- Ensure persona `main_problem` relates to business offering
- Review agent's `why_target_them` reasoning

**Posts Don't Follow Journey Stages**:
- Check if Stage 1 strategies defined clear emotions
- Verify duration_days calculation is correct
- Review post distribution across personas
- Ensure actions match intent levels (awareness=save, conversion=click)

---

## Database (Supabase)

### Tables

**brand_profiles**:
- Stores BusinessProfile objects
- RLS policies for user isolation
- JSONB columns for flexible schema

**Migrations**: `supabase/migrations/`

### Storage Functions

**Location**: `src/utils/storage.ts`

```typescript
saveProfile(profile: BusinessProfile)    // Upsert to Supabase
getProfile(id: string)                   // Fetch by ID
getCurrentProfile()                      // Get active profile
getAllProfiles()                         // Fetch all user profiles
```

---

## Recent Major Changes

### Code Simplification (Oct 2025)

**Removed**:
- 9 unused/duplicate files (2,689 lines)
- Duplicate Supabase client
- Old BrandHub.tsx (525 lines)
- 3 unused Campaign pages
- Test pages from routes
- Redundant documentation

**Result**: -2,689 lines, cleaner architecture

### Brand Hub Simplification (Oct 2025)

**Expert Analysis Applied**:
- Fortune 500 CMO: "60% of fields are noise for AI"
- Social Media Expert: "ONE persona per campaign = viral content"
- Behavioral Psychologist: "30 fields = 15% completion, 9 fields = 70%+"

**Changes**:
- Persona: 15 fields → 6 fields (60% reduction)
- BusinessProfile: 30+ fields → 8 fields (73% reduction)
- PersonaModal: 540 lines → 228 lines (58% reduction)
- BrandHub: 838 lines → 467 lines (44% reduction)

**Total**: -683 lines, better UX, same AI quality

---

## Development Workflow

### Local Setup

```bash
# Install dependencies
npm install

# Start dev server (includes Supabase)
npm run dev

# Visit http://localhost:8080
```

### Git Workflow

```bash
# Push changes
git add .
git commit -m "Your message"
git push origin main

# Auto-deploys to Lovable Cloud
```

### Environment Variables

Already configured in Lovable Cloud:
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_PUBLISHABLE_KEY`
- `LOVABLE_API_KEY` (for edge functions)

---

## Preloaded Demo Profiles

### Stack Creamery 🍦
- **Niche**: Ice cream shop
- **Location**: Springfield, IL
- **Voice**: Fun & playful
- **Personas**:
  - Date Night Dani 💑 (Instagram/TikTok)
  - Event Planner Emma 🎉 (LinkedIn/Facebook)
  - Treat Time Tom 👨‍👧 (Facebook/Google)

### Quick Fix Plumbing 🔧
- **Niche**: Plumbing service
- **Location**: Denver, CO
- **Voice**: Professional & polished
- **Personas**:
  - Fix-It Felix 🔧 (Google/YouTube)
  - Clueless Carla 🤷‍♀️ (Facebook/Nextdoor)
  - Property Manager Pete 🏢 (LinkedIn/Email)

### Test User 🧪
- Empty profile
- Resets on every load
- For development/testing

---

## Common Tasks

### Adding a New Persona Type

1. Update emoji options in `PersonaModalSimplified.tsx`
2. Add example in preloaded profiles (`data/profiles.ts`)
3. Update persona examples in Brand Hub

### Modifying Campaign Generation

1. Update AI prompt in campaign page
2. Ensure all persona fields are used appropriately
3. Test with multiple personas (primary + secondary)

### Adding a New Business Field

⚠️ **Think carefully** - does AI actually need this for content?
1. Add to `BusinessProfile` interface
2. Update `BrandHubSimplified.tsx` UI
3. Update `storage.ts` save/load functions
4. Update Supabase schema if needed

---

## Design Decisions & Rationale

### Why Single-Select Tone (not multi-select)?

**Before**: Users could pick 2-3 tones ("fun & playful" + "warm & friendly")
**Problem**: AI gets confused mixing tones, users over-select
**Fix**: Force ONE primary tone, adds clarity

### Why ONE Main Problem (not 5 pain points)?

**Before**: Users listed 5 pain points per persona
**Problem**: Users struggled to think of 5, AI couldn't focus
**Fix**: ONE problem = ONE campaign angle, ultra-specific

### Why Remove Demographics Fields?

**Before**: Age range, income level, family status, location types
**Problem**: Users guessed, AI infers better from description
**Fix**: "Young couples (25-35)" in description > separate age field

### Why Remove Brand Colors/Identity?

**Before**: Color picker, personality checkboxes, visual style
**Problem**: Used for visual design, not copy/content creation
**Fix**: Focus on voice/tone which affects written content

### Why Support Multiple Personas?

**Business Reality**: Ice cream shop serves couples, families, event planners
**Campaign Reality**: Each campaign targets ONE specific persona
**Solution**: Store 3-5 personas, pick one per campaign

---

## Performance Considerations

### Form Completion Rate

**Old Brand Hub**: 60+ min, 30+ fields → ~15% completion (estimated)
**New Brand Hub**: 10 min, 8 fields → ~70%+ completion (target)

### Code Maintenance

**Before Simplification**:
- 838-line BrandHub
- 540-line PersonaModal
- 2,689 lines of unused code

**After Simplification**:
- 467-line BrandHub (44% reduction)
- 228-line PersonaModal (58% reduction)
- Removed 3,372 total lines across cleanup + simplification

### AI Token Usage

**Optimized**: Fewer fields = smaller prompts = faster response, lower cost

---

## Recent Bug Fixes

### Schema Safety Checks (Oct 7, 2025)

**Issue**: Brand Hub page showed blank when profiles loaded from Supabase database with undefined array fields.

**Root Cause**:
- Database profiles had `voice`, `locations`, `personas`, and `signature_phrases` fields as undefined
- Component tried to call `.map()`, `.length`, `.slice()` on undefined arrays
- Runtime errors: "Cannot read properties of undefined (reading 'map')"

**Fix Applied** (BrandHubSimplified.tsx):
- Added safety checks with optional chaining and nullish coalescing
- Changed `profile.locations.map()` → `(profile.locations || []).map()`
- Changed `profile.voice.tone` → `profile.voice?.tone`
- Changed `persona.platforms.slice()` → `(persona.platforms || []).slice()`
- Applied to all array operations: map, filter, length, slice

**Files Modified**:
- `src/pages/BrandHubSimplified.tsx` - Added 15+ safety checks throughout component
- All array fields now safely default to empty arrays
- All nested objects use optional chaining (`?.`)

**Result**: Brand Hub now loads correctly even when Supabase profiles have missing/undefined fields.

---

## Known Issues & TODOs

### Current Limitations

- [ ] File upload shows modal but doesn't process yet
- [ ] ~~Campaign generation uses mock data~~ ✅ **FIXED**: Multi-agent system implemented (Oct 9, 2025)
- [ ] **Frontend UI needed for campaign generation stages** (Stage 1, 2, 3 approval flows)
- [ ] No user authentication (single user mode)
- [ ] Dashboard stats are placeholder

### Next Priorities (Post-Campaign Agent)

**Frontend Integration** (High Priority):
- [ ] UI for Stage 1: Persona strategy input & approval
- [ ] UI for Stage 2: Content calendar visualization
- [ ] UI for Stage 3: Copy editing interface
- [ ] Visual campaign timeline/calendar view

**Copywriter Agent Deep Dive** (Planned separate session):
- [ ] Refine natural cadence rules
- [ ] Platform-specific voice variations
- [ ] A/B testing framework
- [ ] Slop detection scoring

### Future Enhancements

- [ ] AI-assist buttons ("Generate persona from description")
- [ ] Analytics dashboard with high-intent action tracking
- [ ] Multi-user support with auth
- [ ] Export campaigns to scheduling tools (Buffer, Hootsuite)
- [ ] Advanced fields as collapsible sections
- [ ] Campaign performance feedback loop

---

## Troubleshooting

### TypeScript Errors After Schema Change

```bash
# Run type check
npx tsc --noEmit

# Common fix: restart dev server
# Ctrl+C, then npm run dev
```

### Supabase Connection Issues

```bash
# Check if Supabase is running (local)
supabase status

# Restart Supabase
supabase stop
supabase start
```

### Profile Not Saving

- Check browser console for Supabase errors
- Verify all required fields are filled
- Check RLS policies in Supabase dashboard

---

## Key Files to Know

### Most Edited Files

1. **`src/pages/BrandHubSimplified.tsx`** - Main brand editing interface
2. **`src/components/PersonaModalSimplified.tsx`** - Persona creator
3. **`src/data/profiles.ts`** - Interfaces and demo data
4. **`src/utils/storage.ts`** - Data persistence
5. **`src/config/campaignPrompts.ts`** - ✅ NEW: Campaign agent prompts (312 lines)
6. **`supabase/functions/generate-campaign/index.ts`** - ✅ NEW: Multi-agent system (467 lines)

### Configuration Files

- **`src/App.tsx`** - Routes and page imports
- **`vite.config.ts`** - Build configuration
- **`tailwind.config.ts`** - Theme customization

### Auto-Generated (Don't Edit)

- **`src/integrations/supabase/`** - Lovable manages this
- **`supabase/migrations/`** - Database schema versions

---

## Testing Strategy

### Manual Testing Checklist

**Brand Hub**:
- [ ] Create new persona (all 6 fields)
- [ ] Edit existing persona
- [ ] Delete persona
- [ ] Add/remove locations
- [ ] Add/remove signature phrases (max 5)
- [ ] Change tone selection
- [ ] Auto-save triggers after 30s
- [ ] Manual save button works

**Multi-Persona**:
- [ ] Create 3+ personas for one business
- [ ] Each persona has different platforms
- [ ] Each persona has unique problem
- [ ] Real examples are optional

**Data Persistence**:
- [ ] Refresh page, data persists
- [ ] Switch profiles, correct data loads
- [ ] Navigate away and back, changes saved

---

## Contact & Resources

**Project Repo**: [GitHub Link]
**Deployment**: Lovable Cloud
**Documentation**:
- [Lovable Docs](https://docs.lovable.dev)
- [Supabase Docs](https://supabase.com/docs)
- [Shadcn/UI](https://ui.shadcn.com)

---

## Quick Reference

### Start Development
```bash
npm run dev
```

### Run Type Check
```bash
npx tsc --noEmit
```

### Deploy
```bash
git push origin main  # Auto-deploys
```

### View Database
```bash
supabase db studio  # Opens local DB UI
```

---

## Recent Major Updates

### Campaign Generation Agent System (Oct 9, 2025)

**What Changed**: Complete rewrite of campaign generation as a sophisticated multi-agent system.

**Files Added**:
- `src/config/campaignPrompts.ts` (312 lines)
- `supabase/functions/generate-campaign/index.ts` (467 lines)

**Key Features**:
- Three-stage agent system (Persona Strategy → Content Calendar → Copywriter)
- Business owner mental model (natural language goals)
- Emotion-driven strategy with high-intent action focus
- Anti-AI-slop mechanisms (natural cadence rules, banned phrases)
- Approval gates at each stage
- Customer journey orchestration (Awareness → Consideration → Conversion)

**Philosophy**: "Content that sounds like a person talking, not a polished marketing message"

**Status**: Backend fully implemented, frontend UI integration needed

---

*Last Updated: October 9, 2025*
*Project Version: MVP - Campaign Generation Agent System*
